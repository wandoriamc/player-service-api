syntax = "proto3";
import "google/protobuf/empty.proto";
package player;

option java_outer_classname = "PlayerProto";
option java_multiple_files = true;
option java_package = "it.einjojo.protocol.player";




service PlayerService {
  rpc GetOfflinePlayerByUniqueId(PlayerIdRequest) returns (GetOfflinePlayerResponse);
  rpc GetOnlinePlayerByUniqueId(PlayerIdRequest) returns (GetOnlinePlayerResponse);
  rpc GetOfflinePlayerByName(PlayerNameRequest) returns (GetOfflinePlayerResponse);
  rpc GetOnlinePlayerByName(PlayerNameRequest) returns (GetOnlinePlayerResponse);

  rpc GetOnlinePlayers(google.protobuf.Empty) returns (GetOnlinePlayersResponse);
  rpc GetOnlinePlayerNames(google.protobuf.Empty) returns (GetOnlinePlayerNamesResponse);

  rpc UpdateConnection(UpdateConnectionRequest) returns (UpdateConnectionResponse);
  rpc Login(LoginRequest) returns (LoginNotify);
  rpc Logout(LogoutRequest) returns (LogoutNotify);
  rpc GetUniqueIdByName(PlayerNameRequest) returns (UniqueIdLookupResponse);
}



message GetOnlinePlayersResponse {
  repeated OnlinePlayerDefinition players = 1;
}



message GetOnlinePlayerNamesResponse {
  repeated string names = 1;
}

message OfflinePlayerDefinition {
  string unique_id = 1;
  string username = 2;
  int64 first_login = 3;
  int64 last_login = 4;
  // playtime millis
  int64 online_time = 5;
  bool online = 6;
}

message PlayerIdRequest {
  string unique_id = 1;
}

message PlayerNameRequest {
  string name = 1;
}

message GetOnlinePlayerResponse {
  OnlinePlayerDefinition player = 1;
}

message OnlinePlayerDefinition {
  string unique_id = 1;
  string username = 2;
  int64 first_login = 3;
  int64 last_login = 4;
  // playtime millis
  int64 online_time = 5;
  string connected_server_name = 6;
  string connected_proxy_name = 7;
  int64 session_id = 8;
}

message UniqueIdLookupResponse {
  string unique_id = 1;
}

message GetOfflinePlayerResponse {
  OfflinePlayerDefinition player = 1;
}

// Player has switched servers | Proxy -> Service
message UpdateConnectionRequest {
  string unique_id = 1;
  string connected_server_name = 2;
}


// Service -> Proxy, response to UpdateConnectionRequest
message UpdateConnectionResponse {
  bool success = 1;
}

// Proxy -> Service, when a player logs in
message LoginRequest {
  string unique_id = 1;
  string username = 2;
  string proxy_name = 3;
  string skin_texture = 4;
  string skin_signature = 5;
}

// Dispatched by Service when a player has logged in
message LoginNotify {
  OnlinePlayerDefinition player = 1;
  uint64 timestamp = 2;
}

// Proxy -> Service, when a player quits
message LogoutRequest {
  string unique_id = 1;
}

// Dispatched by Service when a player has been logged out
message LogoutNotify {
  bool success = 1;
  int64 closed_session_id = 2;
  OfflinePlayerDefinition player = 3;
}

/*
 Added in v1.4.4 and only api related | no need for service implementation
*/


// Game --redis-> Proxy
message ConnectRequest {
  string unique_id = 1; // the unique-id of the player to connect
  string server_name = 2; // the server-name to connect to
  optional int32 response_key = 3; // If set, the proxy will respond with a ConnectResponse
}

// Proxy --redis--> Game
message ConnectResponse {
  ConnectResult result = 1; // the result of the connection attempt
  int32 response_key = 2; // Used by the requester to match responses with their corresponding requests
}

// Possible results for ConnectResponse
enum ConnectResult {
  SUCCESS = 0; // no failure
  SERVER_NOT_FOUND = 1; // the target server was not found
  CONNECTION_ERROR = 2; // there was a connection error
  PLAYER_NOT_FOUND = 3; // the player was not found on the proxy
}
